<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greater London Sauna Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'EB Garamond', Georgia, 'Times New Roman', serif;
            background: #fff;
            color: #111;
            overflow: hidden;
        }

        #password-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #fff;
        }

        #password-form {
            text-align: center;
            max-width: 320px;
            padding: 40px;
        }

        #password-form h2 {
            font-size: 14px;
            font-weight: 400;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: #111;
            margin-bottom: 48px;
        }

        #password-input {
            width: 100%;
            padding: 12px 0;
            border: none;
            border-bottom: 1px solid #111;
            font-size: 16px;
            font-family: 'EB Garamond', Georgia, serif;
            background: transparent;
            color: #111;
            text-align: center;
            letter-spacing: 0.1em;
        }

        #password-input:focus {
            outline: none;
            border-bottom-width: 2px;
        }

        #password-input::placeholder {
            color: #999;
        }

        button {
            margin-top: 32px;
            padding: 12px 48px;
            background: #111;
            color: #fff;
            border: none;
            font-size: 12px;
            font-family: 'EB Garamond', Georgia, serif;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #333;
        }

        .error {
            color: #111;
            margin-top: 24px;
            font-size: 13px;
            font-style: italic;
            display: none;
        }

        #map-screen {
            display: none;
            height: 100vh;
            flex-direction: column;
        }

        #map-header {
            background: #fff;
            padding: 20px 32px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #map-header h1 {
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        #map-header p {
            font-size: 12px;
            color: #666;
            letter-spacing: 0.1em;
        }

        #map {
            flex: 1;
            width: 100%;
            background: #f5f5f5;
        }

        /* Minimal Leaflet overrides */
        .leaflet-container {
            background: #f5f5f5;
            font-family: 'EB Garamond', Georgia, serif;
        }

        .leaflet-popup-content-wrapper {
            background: #fff;
            color: #111;
            border-radius: 0;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            padding: 0;
        }

        .leaflet-popup-tip {
            background: #fff;
        }

        .leaflet-popup-close-button {
            color: #111 !important;
            font-size: 20px !important;
            padding: 8px 10px !important;
        }

        .leaflet-popup-content {
            margin: 0;
            min-width: 260px;
            max-width: 300px;
        }

        .popup-inner {
            padding: 20px 24px;
        }

        .popup-inner h3 {
            font-size: 18px;
            font-weight: 500;
            margin: 0 0 8px 0;
            line-height: 1.3;
        }

        .popup-inner .address {
            font-size: 13px;
            color: #666;
            margin: 0 0 8px 0;
            line-height: 1.5;
        }

        .popup-inner .hours {
            font-size: 12px;
            color: #111;
            margin: 0 0 16px 0;
            padding: 6px 10px;
            background: #f5f5f5;
            display: inline-block;
        }

        .popup-inner a.website-link {
            display: inline-block;
            font-size: 12px;
            color: #111;
            text-decoration: none;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border-bottom: 1px solid #111;
            padding-bottom: 2px;
            transition: opacity 0.2s;
        }

        .popup-inner a.website-link:hover {
            opacity: 0.6;
        }

        .notes-section {
            border-top: 1px solid #e0e0e0;
            padding: 16px 24px;
            background: #fafafa;
        }

        .notes-section label {
            display: block;
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 8px;
        }

        .notes-section textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #ddd;
            font-family: 'EB Garamond', Georgia, serif;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            background: #fff;
        }

        .notes-section textarea:focus {
            outline: none;
            border-color: #111;
        }

        .notes-section .save-note {
            margin-top: 10px;
            padding: 8px 20px;
            font-size: 11px;
            background: #111;
            color: #fff;
        }

        .notes-section .note-saved {
            display: none;
            margin-top: 10px;
            font-size: 12px;
            font-style: italic;
            color: #666;
        }

        /* Leaflet controls */
        .leaflet-control-zoom a {
            background: #fff !important;
            color: #111 !important;
            border: 1px solid #ddd !important;
            border-radius: 0 !important;
            width: 32px !important;
            height: 32px !important;
            line-height: 30px !important;
            font-size: 16px !important;
        }

        .leaflet-control-zoom a:hover {
            background: #f5f5f5 !important;
        }

        .leaflet-control-zoom {
            border: none !important;
            box-shadow: none !important;
        }

        .leaflet-control-attribution {
            background: rgba(255,255,255,0.9) !important;
            font-size: 10px;
            font-family: 'EB Garamond', Georgia, serif;
        }

        .leaflet-control-attribution a {
            color: #666 !important;
        }

        /* Custom marker */
        .custom-marker {
            width: 12px;
            height: 12px;
            background: #111;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 1px 4px rgba(0,0,0,0.3);
        }

        /* Add Sauna Button */
        #add-sauna-btn {
            position: fixed;
            bottom: 32px;
            right: 32px;
            background: #111;
            color: #fff;
            border: none;
            padding: 14px 28px;
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            z-index: 1000;
            font-family: 'EB Garamond', Georgia, serif;
            transition: background 0.2s;
        }

        #add-sauna-btn:hover {
            background: #333;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.95);
            overflow-y: auto;
        }

        .modal-content {
            background: #fff;
            margin: 60px auto;
            padding: 48px;
            max-width: 520px;
            border: 1px solid #e0e0e0;
        }

        .modal-content h2 {
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .modal-content > p {
            font-size: 15px;
            color: #666;
            margin-bottom: 36px;
            line-height: 1.6;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            color: #111;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.6;
        }

        .form-group {
            margin-bottom: 28px;
        }

        .form-group label {
            display: block;
            font-size: 11px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 10px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            font-size: 15px;
            font-family: 'EB Garamond', Georgia, serif;
            background: #fff;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #111;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.6;
        }

        .form-group small {
            display: block;
            color: #999;
            margin-top: 6px;
            font-size: 13px;
            font-style: italic;
        }

        .rating-group {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .rating-group input[type="radio"] {
            display: none;
        }

        .rating-group label {
            padding: 8px 16px;
            border: 1px solid #ddd;
            cursor: pointer;
            font-size: 14px;
            text-transform: none;
            letter-spacing: 0;
            transition: all 0.2s;
        }

        .rating-group input[type="radio"]:checked + label {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        .rating-group label:hover {
            border-color: #111;
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
        }

        .success-message {
            background: #111;
            color: #fff;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: none;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            #map-header {
                padding: 16px 20px;
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            #map-header h1 {
                font-size: 12px;
            }

            #add-sauna-btn {
                bottom: 20px;
                right: 20px;
                padding: 12px 20px;
            }

            .modal-content {
                margin: 20px;
                padding: 32px 24px;
            }

            #password-form {
                padding: 24px;
            }

            .rating-group {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Password Screen -->
    <div id="password-screen">
        <div id="password-form">
            <h2>Greater London Sauna Map</h2>
            <input type="password" id="password-input" placeholder="Enter password" autocomplete="off" />
            <button onclick="checkPassword()">Enter</button>
            <div class="error" id="error-message">Incorrect password</div>
        </div>
    </div>

    <!-- Map Screen -->
    <div id="map-screen">
        <div id="map-header">
            <h1>Greater London Sauna Map</h1>
            <p>42 locations</p>
        </div>
        <div id="map"></div>
        <button id="add-sauna-btn">+ Add Sauna</button>
    </div>

    <!-- Add/Review Sauna Modal -->
    <div id="sauna-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add or Review a Sauna</h2>
            <p>Know a great sauna we're missing? Share it with the community.</p>

            <div id="success-msg" class="success-message">
                Thank you. Your submission has been received.
            </div>

            <form id="sauna-form">
                <div class="form-group">
                    <label for="submission-type">What would you like to do?</label>
                    <select id="submission-type" required>
                        <option value="">Select an option</option>
                        <option value="new">Add a new sauna</option>
                        <option value="review">Review an existing sauna</option>
                    </select>
                </div>

                <div class="form-group" id="sauna-select-group" style="display: none;">
                    <label for="existing-sauna">Select Sauna</label>
                    <select id="existing-sauna">
                        <option value="">Choose a sauna to review</option>
                    </select>
                </div>

                <div class="form-group" id="sauna-name-group">
                    <label for="sauna-name">Sauna Name</label>
                    <input type="text" id="sauna-name" required>
                </div>

                <div class="form-group" id="sauna-address-group">
                    <label for="sauna-address">Address</label>
                    <input type="text" id="sauna-address" placeholder="Full street address with postcode" required>
                </div>

                <div class="form-group" id="sauna-website-group">
                    <label for="sauna-website">Website</label>
                    <input type="url" id="sauna-website" placeholder="https://">
                </div>

                <div class="form-group">
                    <label>Rating</label>
                    <div class="rating-group">
                        <input type="radio" name="rating" id="rating-1" value="1">
                        <label for="rating-1">1</label>
                        <input type="radio" name="rating" id="rating-2" value="2">
                        <label for="rating-2">2</label>
                        <input type="radio" name="rating" id="rating-3" value="3">
                        <label for="rating-3">3</label>
                        <input type="radio" name="rating" id="rating-4" value="4">
                        <label for="rating-4">4</label>
                        <input type="radio" name="rating" id="rating-5" value="5">
                        <label for="rating-5">5</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="review-text">Your Review</label>
                    <textarea id="review-text" placeholder="Tell us about your experience..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="reviewer-name">Your Name</label>
                    <input type="text" id="reviewer-name" placeholder="Anonymous">
                </div>

                <div class="form-group">
                    <label for="reviewer-email">Your Email</label>
                    <input type="email" id="reviewer-email" placeholder="For follow-up only">
                    <small>We'll only use this to contact you about your submission</small>
                </div>

                <button type="submit" class="submit-btn">Submit</button>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script>
        // Password hash (SHA-256 of 'shvitz')
        const PASSWORD_HASH = 'ebbfe519cebbbb572da632ae0263eeac94b828b4e27a3e55f271242060580df6';

        // Sauna data
        const saunaData = [
            {"name": "ARC", "address": "Minus Level 2, 1 Crossrail Place, Canary Wharf, London E14 5AR", "lat": 51.5048954, "lon": -0.0190006, "website": "https://www.arc-community.com/", "hours": "Daily, session-based booking"},
            {"name": "Banya No.1 Chiswick", "address": "404-406 Chiswick High Road, London W4 5TF", "lat": 51.4923137, "lon": -0.263818, "website": "https://gobanyachiswick.co.uk/", "hours": "Daily 9:30am–10:30pm"},
            {"name": "Banya No.1 Hoxton", "address": "17 Micawber Street, London N1 7TB", "lat": 51.5323935, "lon": -0.086078, "website": "https://gobanya.co.uk/", "hours": "Daily 9:30am–10:30pm"},
            {"name": "BlocFit Climbing Wall", "address": "Arch 266, 241 Coldharbour Lane, London SW9 8RR", "lat": 51.4662551, "lon": -0.1021612, "website": "https://www.blocfit.co.uk/", "hours": "Daily, check website for times"},
            {"name": "Blok Hot+Cold", "address": "Unit UJ5, The Tram Depot, 38-40 Upper Clapton Road, London E5 8BQ", "lat": 51.558602, "lon": -0.0558777, "website": "https://www.bloklondon.com/hotcold", "hours": "Mon–Fri 6am–9:30pm, Sat 8:30am–6pm, Sun 9am–5:30pm"},
            {"name": "Community Sauna Baths, Camberwell", "address": "Ruskin Park, Denmark Hill, London SE5 9AW", "lat": 51.4745706, "lon": -0.0925416, "website": "https://www.community-sauna.co.uk/", "hours": "Daily 7am–9:30pm"},
            {"name": "Community Sauna Baths, Hackney", "address": "The Baths 80, Eastway, London E9 5JH", "lat": 51.5434383, "lon": -0.0241542, "website": "https://www.community-sauna.co.uk/", "hours": "Daily 8am–9:30pm"},
            {"name": "Community Sauna Baths, Peckham", "address": "64 Glengall Road, Glengall Wharf Garden, Burgess Park, London SE15 6NH", "lat": 51.4734122, "lon": -0.0699321, "website": "https://www.community-sauna.co.uk/", "hours": "Daily 7am–9:30pm"},
            {"name": "Community Sauna Baths, Stratford", "address": "Stratford, London E15", "lat": 51.541289, "lon": -0.0035472, "website": "https://www.community-sauna.co.uk/", "hours": "Daily 7am–9:30pm"},
            {"name": "Community Sauna Baths, Walthamstow", "address": "Walthamstow, London E17", "lat": 51.5844701, "lon": -0.0188186, "website": "https://www.community-sauna.co.uk/", "hours": "Daily 7am–9:30pm"},
            {"name": "Contrast Anerley", "address": "Unit 106, 183A Anerley Road, London SE20 8EF", "lat": 51.4088267, "lon": -0.0611263, "website": "https://www.contrastlondon.co.uk/", "hours": "By appointment, book 6hrs ahead"},
            {"name": "Drip Sauna", "address": "Coaling Jetty, Battersea Power Station, London SW11 8BZ", "lat": 51.4707933, "lon": -0.172214, "website": "https://www.dripsauna.co.uk/", "hours": "Daily, session-based booking"},
            {"name": "Finnish Church in London", "address": "33 Albion Street, Rotherhithe, London SE16 7HZ", "lat": 51.5002908, "lon": -0.0436321, "website": "https://britannia.merimieskirkko.fi/en/", "hours": "Wed–Sun, check website"},
            {"name": "Hot & Cold UK", "address": "662 High Road Leytonstone, London E11 3AA", "lat": 51.5683955, "lon": 0.0111704, "website": "https://hotandcoldonline.co.uk/", "hours": "Daily 6am–9pm"},
            {"name": "Innervisions Alchemy", "address": "Bermondsey, London", "lat": 51.4970125, "lon": -0.063268, "website": "https://saunamap.uk/sauna/innervisions-sauna/", "hours": "Check website"},
            {"name": "Little Healing", "address": "Ealing, London", "lat": 51.5126553, "lon": -0.3051952, "website": "https://saunamap.uk/sauna/little-healing/", "hours": "Check website"},
            {"name": "LoWLU, Kentish Town", "address": "Caversham Road, Kentish Town, London NW5", "lat": 51.5500554, "lon": -0.1425712, "website": "https://www.lowlu.co/", "hours": "Daily 7am–9pm"},
            {"name": "LoWLU, Wandsworth", "address": "Wandsworth, London SW18", "lat": 51.4570271, "lon": -0.1932607, "website": "https://www.lowlu.co/", "hours": "Daily 6am–9pm"},
            {"name": "Mile End Climbing Wall", "address": "Haverfield Road, Mile End Park, London E3 5BE", "lat": 51.5253378, "lon": -0.033435, "website": "https://www.mileendwall.org.uk/", "hours": "Mon–Fri 7am–10pm, Sat–Sun 9am–8pm"},
            {"name": "New Docklands Steam Baths", "address": "30a Stephenson Street, Canning Town, London E16 4SA", "lat": 51.5139887, "lon": 0.0082987, "website": "https://newdocklands.uk/", "hours": "Tue–Sun, varies by day"},
            {"name": "Old Kent Road Sauna", "address": "Old Kent Road, London SE15", "lat": 51.4752983, "lon": -0.0404289, "website": "https://www.oldkentroadsauna.com/", "hours": "Check website"},
            {"name": "Porchester Spa", "address": "Porchester Centre, Porchester Road, Queensway, London W2 5HS", "lat": 51.5122764, "lon": -0.1883854, "website": "https://www.porchesterspatreatments.co.uk/", "hours": "Mon–Fri 10am–9:30pm, Sat–Sun 10am–8pm"},
            {"name": "Putney Recovery Room", "address": "Putney, London", "lat": 51.4625314, "lon": -0.2163018, "website": "https://saunamap.uk/sauna/putney-recovery-room/", "hours": "Check website"},
            {"name": "Rebase", "address": "1a St Vincent Street, Marylebone, London W1U 4DA", "lat": 51.5196374, "lon": -0.1519627, "website": "https://www.rebaserecovery.com/", "hours": "Mon–Fri 7am–9pm, Sat–Sun 8am–8pm"},
            {"name": "Revitalise Urban Spa", "address": "Lower Clapton, London", "lat": 51.5546565, "lon": -0.0550912, "website": "https://saunamap.uk/sauna/revitalise-urban-spa/", "hours": "Check website"},
            {"name": "Rooftop Saunas, Brixton", "address": "International House, 11th Floor, Brixton, London SW9", "lat": 51.4633914, "lon": -0.1148023, "website": "https://rooftopsaunas.com/", "hours": "Mon–Sat 8am–10:20pm, Sun 9am–7:40pm"},
            {"name": "Rooftop Saunas, Hackney", "address": "Netil Corner, 2 Bocking Street, London E8 4RU", "lat": 51.5432402, "lon": -0.0493621, "website": "https://rooftopsaunas.com/", "hours": "Mon–Sat 7:30am–10:20pm, Sun 10am–7:50pm"},
            {"name": "Sauna & Plunge", "address": "124 Tabernacle Street, Shoreditch, London EC2A 4SA", "lat": 51.5266694, "lon": -0.0798926, "website": "https://saunaandplunge.life/", "hours": "Daily 6:30am–8pm"},
            {"name": "Sauna Social Club", "address": "Railway Arch 842, Brayards Road, Peckham, London SE15 2AG", "lat": 51.4734122, "lon": -0.0699321, "website": "https://www.saunasocialclub.co.uk/", "hours": "Wed–Sun, session-based"},
            {"name": "Saunos", "address": "49-50 Eagle Wharf Road, London N1 7ED", "lat": 51.5323935, "lon": -0.086078, "website": "https://www.legitfit.com/p/timetable/saunoslimited", "hours": "Check website for sessions"},
            {"name": "Skuna Sauna, London", "address": "West India Quay, Hertsmere Road, Canary Wharf, London E14 4AL", "lat": 51.5048954, "lon": -0.0190006, "website": "https://www.skunasauna.com/", "hours": "Mon–Fri 12pm–9pm, Sat–Sun 10am–9pm"},
            {"name": "Stoke Newington Sauna", "address": "Stoke Newington, London", "lat": 51.5578698, "lon": -0.0822482, "website": "https://saunamap.uk/sauna/stoke-newington-sauna/", "hours": "Check website"},
            {"name": "SweHeat Sauna", "address": "Canning Town, London", "lat": 51.5139887, "lon": 0.0082987, "website": "https://saunamap.uk/sauna/sweheat-sauna/", "hours": "Check website"},
            {"name": "Temz Floating Saunas", "address": "The Lensbury, Broom Road, Teddington, London TW11 9NU", "lat": 51.4277844, "lon": -0.333653, "website": "https://www.temzfloatingsaunas.com/", "hours": "By appointment, 50-min sessions"},
            {"name": "The Bath House", "address": "1 Grosvenor Gardens, Belgravia, London SW1W 0BD", "lat": 51.4982128, "lon": -0.1534998, "website": "https://banyalondon.co.uk/", "hours": "Mon–Sat 10am–11pm, Sun 10am–10pm"},
            {"name": "The Cabin Sauna", "address": "Clapham Common, London SW4", "lat": 51.4614469, "lon": -0.138627, "website": "https://thecabinsauna.co.uk/", "hours": "Seasonal (Oct–May), check website"},
            {"name": "The Sanctuary at &Soul Community", "address": "Shoreditch, London", "lat": 51.5266694, "lon": -0.0798926, "website": "https://saunamap.uk/sauna/the-sanctuary-at-soul/", "hours": "Check website"},
            {"name": "Urban Heat Sauna", "address": "Camberwell, London", "lat": 51.4745706, "lon": -0.0925416, "website": "https://saunamap.uk/sauna/urban-heat-sauna/", "hours": "Check website"},
            {"name": "WellNest", "address": "7 Crucifix Lane, London Bridge, London SE1 3JW", "lat": 51.5061349, "lon": -0.1011379, "website": "https://www.wellnest.london/", "hours": "Mon–Fri 7am–10pm, Sat 9am–6pm, Sun 10am–5pm"}
        ];

        // Notes storage
        function getNotes() {
            return JSON.parse(localStorage.getItem('saunaNotes') || '{}');
        }

        function saveNote(saunaName, note) {
            const notes = getNotes();
            notes[saunaName] = note;
            localStorage.setItem('saunaNotes', JSON.stringify(notes));
        }

        function getNote(saunaName) {
            return getNotes()[saunaName] || '';
        }

        // Hash password using SHA-256
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // Check password
        async function checkPassword() {
            const input = document.getElementById('password-input');
            const errorMsg = document.getElementById('error-message');
            const hash = await hashPassword(input.value);

            if (hash === PASSWORD_HASH) {
                document.getElementById('password-screen').style.display = 'none';
                document.getElementById('map-screen').style.display = 'flex';
                initializeMap();
            } else {
                errorMsg.style.display = 'block';
                input.value = '';
                input.focus();
            }
        }

        // Enter key to submit
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('password-input');
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkPassword();
            });
            input.focus();
        });

        // Custom marker icon
        const customIcon = L.divIcon({
            className: 'custom-marker',
            iconSize: [12, 12],
            iconAnchor: [6, 6],
            popupAnchor: [0, -8]
        });

        // Initialize map
        function initializeMap() {
            const map = L.map('map').setView([51.5074, -0.1278], 11);

            // Greyscale map tiles (CartoDB Positron - clean greyscale, no API key)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>'
            }).addTo(map);

            // Add markers
            saunaData.forEach(sauna => {
                const marker = L.marker([sauna.lat, sauna.lon], { icon: customIcon });

                const existingNote = getNote(sauna.name);
                const popupContent = `
                    <div class="popup-inner">
                        <h3>${sauna.name}</h3>
                        <p class="address">${sauna.address}</p>
                        <p class="hours">${sauna.hours}</p>
                        <a href="${sauna.website}" target="_blank" rel="noopener noreferrer" class="website-link">Visit Website</a>
                    </div>
                    <div class="notes-section">
                        <label>Your Notes</label>
                        <textarea id="note-${sauna.name.replace(/[^a-zA-Z0-9]/g, '_')}" placeholder="Add your notes about this sauna...">${existingNote}</textarea>
                        <button type="button" class="save-note" onclick="handleSaveNote('${sauna.name.replace(/'/g, "\\'")}')">Save Note</button>
                        <div class="note-saved" id="saved-${sauna.name.replace(/[^a-zA-Z0-9]/g, '_')}">Note saved</div>
                    </div>
                `;

                marker.bindPopup(popupContent, { maxWidth: 320 });
                marker.addTo(map);
            });
        }

        // Handle save note
        function handleSaveNote(saunaName) {
            const textareaId = 'note-' + saunaName.replace(/[^a-zA-Z0-9]/g, '_');
            const savedId = 'saved-' + saunaName.replace(/[^a-zA-Z0-9]/g, '_');
            const textarea = document.getElementById(textareaId);
            const savedMsg = document.getElementById(savedId);

            if (textarea) {
                saveNote(saunaName, textarea.value);
                savedMsg.style.display = 'block';
                setTimeout(() => {
                    savedMsg.style.display = 'none';
                }, 2000);
            }
        }

        // Modal functionality
        const modal = document.getElementById('sauna-modal');
        const addBtn = document.getElementById('add-sauna-btn');
        const closeBtn = document.querySelector('.close');
        const submissionType = document.getElementById('submission-type');
        const saunaSelect = document.getElementById('existing-sauna');
        const saunaForm = document.getElementById('sauna-form');

        // Populate dropdown
        saunaData.forEach(sauna => {
            const option = document.createElement('option');
            option.value = sauna.name;
            option.textContent = sauna.name;
            saunaSelect.appendChild(option);
        });

        addBtn.onclick = () => {
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        };

        closeBtn.onclick = () => {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        };

        window.onclick = (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        };

        submissionType.onchange = (e) => {
            const type = e.target.value;
            const saunaSelectGroup = document.getElementById('sauna-select-group');
            const saunaNameGroup = document.getElementById('sauna-name-group');
            const saunaAddressGroup = document.getElementById('sauna-address-group');
            const saunaWebsiteGroup = document.getElementById('sauna-website-group');

            if (type === 'review') {
                saunaSelectGroup.style.display = 'block';
                saunaNameGroup.style.display = 'none';
                saunaAddressGroup.style.display = 'none';
                saunaWebsiteGroup.style.display = 'none';
                document.getElementById('sauna-name').required = false;
                document.getElementById('sauna-address').required = false;
            } else if (type === 'new') {
                saunaSelectGroup.style.display = 'none';
                saunaNameGroup.style.display = 'block';
                saunaAddressGroup.style.display = 'block';
                saunaWebsiteGroup.style.display = 'block';
                document.getElementById('sauna-name').required = true;
                document.getElementById('sauna-address').required = true;
            } else {
                saunaSelectGroup.style.display = 'none';
                saunaNameGroup.style.display = 'none';
                saunaAddressGroup.style.display = 'none';
                saunaWebsiteGroup.style.display = 'none';
            }
        };

        saunaForm.onsubmit = (e) => {
            e.preventDefault();

            const formData = {
                type: document.getElementById('submission-type').value,
                existingSauna: document.getElementById('existing-sauna').value,
                name: document.getElementById('sauna-name').value,
                address: document.getElementById('sauna-address').value,
                website: document.getElementById('sauna-website').value,
                rating: document.querySelector('input[name="rating"]:checked')?.value,
                review: document.getElementById('review-text').value,
                reviewerName: document.getElementById('reviewer-name').value || 'Anonymous',
                reviewerEmail: document.getElementById('reviewer-email').value,
                timestamp: new Date().toISOString()
            };

            const submissions = JSON.parse(localStorage.getItem('saunaSubmissions') || '[]');
            submissions.push(formData);
            localStorage.setItem('saunaSubmissions', JSON.stringify(submissions));

            document.getElementById('success-msg').style.display = 'block';
            saunaForm.reset();

            setTimeout(() => {
                document.getElementById('success-msg').style.display = 'none';
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 2500);
        };
    </script>
</body>
</html>
